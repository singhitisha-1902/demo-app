# cds-react-table

Tables are a way to display a collection of data or information in a grid of rows and columns. They organize information in a way that allows users to scan, analyze, compare, filter, sort, and apply actions to large amounts of information providing insights from the data.

> [Design Guidelines](https://magnetic.cisco.com/0a43ab5cd/p/313a90-table)

## Installation

NPM: `npm i @ciscodesignsystems/cds-react-table`

Yarn: `yarn add @ciscodesignsystems/cds-react-table`

## Styling and Theme Installation

You will also need to install the styling and needed theme files.

NPM: `npm i @ciscodesignsystems/cds-magnetic-theme-web`

Yarn: `yarn add @ciscodesignsystems/cds-magnetic-theme-web`

Then import the following into your app's css:

```css
@import '@ciscodesignsystems/cds-magnetic-theme-web/css/dist/token-theme-light-variables.css';
@import '@ciscodesignsystems/cds-react-table/index.css';
```

## Dependencies

### Required

These dependencies must be met in your product:

- [react](https://www.npmjs.com/package/react) >=16.14.0
- [react-dom](https://www.npmjs.com/package/react-dom) >=16.14.0
- @ciscodesignsystems/cds-component-types
- @ciscodesignsystems/cds-component-utilities
- @ciscodesignsystems/cds-react-button
- @ciscodesignsystems/cds-react-checkbox
- @ciscodesignsystems/cds-react-drawer
- @ciscodesignsystems/cds-react-empty-state
- @ciscodesignsystems/cds-react-flex
- @ciscodesignsystems/cds-react-icons
- @ciscodesignsystems/cds-react-select
- @ciscodesignsystems/cds-react-skeleton

### Optional

Optional dependencies will vary depending on your product needs, but may include the following components:

- @ciscodesignsystems/cds-react-tooltip
- @ciscodesignsystems/cds-react-select
- @ciscodesignsystems/cds-react-tag
- @ciscodesignsystems/cds-react-text-input

## Usage

### Basic Example

```tsx
export const Component = () => {
  const columns = [
    {
      header: 'First Name',
      accessorKey: 'firstName',
    },
    {
      header: 'Last Name',
      accessorKey: 'lastName',
      size: 500,
      meta: {
        align: 'left',
      },
    },
  ];
  const data = [
    {
      firstName: 'Robby',
      lastName: 'Gaythwaite',
    },
    {
      firstName: 'Laureen',
      lastName: 'Dutt',
    },
    {
      firstName: 'Burlie',
      lastName: 'Routley',
    },
  ];
  const [selectedRows, setSelectedRows] = useState<CDSTableSelection>({});
  return (
    <CDSTable
      columns={columns}
      data={people}
      pagination={true}
      sticky={true}
      rowSelection={selectedRows}
      onRowSelectionChange={setSelectedRows}
    />
  );
};
```

### With Filtering

```tsx
export const Component = () => {
  const [liveFilter, setLiveFilter] = useState<boolean>(false);
  const [usageFilter, setUsageFilter] = useState<boolean>(false);
  const [gmailFilter, setGmailFilter] = useState<boolean>(false);
  const [yahooFilter, setYahooFilter] = useState<boolean>(false);
  const [hotmailFilter, setHotmailFilter] = useState<boolean>(false);

  const columnFilters: CDSTableColumnFilters = [
    ...(liveFilter
      ? [
          {
            id: 'live',
            value: liveFilter,
          },
        ]
      : []),
    ...(usageFilter
      ? [
          {
            id: 'usage',
            value: usageFilter,
          },
        ]
      : []),
    ...(gmailFilter || yahooFilter || hotmailFilter
      ? [
          {
            id: 'email',
            value: [
              ...(gmailFilter ? ['gmail.com'] : []),
              ...(yahooFilter ? ['yahoo.com'] : []),
              ...(hotmailFilter ? ['hotmail.com'] : []),
            ],
          },
        ]
      : []),
  ];

  const filterDrawerContent = (
    <div>
      <h3>Email domain</h3>
      <CDSFlex direction="vertical" gap="sm">
        <CDSCheckbox checked={gmailFilter} onChange={(e) => setGmailFilter(e.target.checked)}>
          gmail.com
        </CDSCheckbox>
        <CDSCheckbox checked={yahooFilter} onChange={(e) => setYahooFilter(e.target.checked)}>
          yahoo.com
        </CDSCheckbox>
        <CDSCheckbox checked={hotmailFilter} onChange={(e) => setHotmailFilter(e.target.checked)}>
          hotmail.com
        </CDSCheckbox>
      </CDSFlex>
    </div>
  );

  const keyFilterContent = (
    <>
      <CDSCheckbox checked={liveFilter} onChange={(e) => setLiveFilter(e.target.checked)}>
        Live
      </CDSCheckbox>
      <CDSCheckbox checked={usageFilter} onChange={(e) => setUsageFilter(e.target.checked)}>
        Usage
      </CDSCheckbox>
    </>
  );

  return (
    <CDSTable columns={columns} data={people} columnFilters={columnFilters}>
      <CDSTable.FilterBar
        filterDrawerChildren={filterDrawerContent}
        keyFilterChildren={keyFilterContent}
      />
    </CDSTable>
  );
};
```

By default, the column filters use a case-insensitive string inclusion to perform the filtering. If a different filter function is required, please look at
[@tanstack/react-table Filtering](https://tanstack.com/table/v8/docs/api/features/filters?from=reactTableV7&original=https://github.com/TanStack/table/tree/v7/docs/src/pages/docs/api/useFilters.md)
for more functions. These filter functions can be placed inside the column definitions as so:

```tsx
const columnDef = [
  {
    header: 'Email',
    accessorKey: 'email',
    meta: {
      align: 'left',
    },
    filterFn: 'arrIncludes',
  },
];
```

If the pre-existing filter functions are not adequate, it is possible to pass a function into the `filterFn` key.

```tsx
const columnDef = [
  {
    header: 'Email',
    accessorKey: 'email',
    meta: {
      align: 'left',
    },
    filterFn: (row, columnId, value: string[], addMeta) =>
      value.some((extension) => (row.getValue(columnId) as string).indexOf(extension) > -1),
  },
];
```

### With Column Display Settings

```tsx
export const Component = () => {
  const columnDef = [
    {
      ... // YOUR COLUMN DEFINITION
      meta: {
        // FOR EACH COLUMN, DEFINE THE LABEL TO BE SHOWN
        // IN THE SETTINGS DISPLAY DRAWER
        columnVisibilityFilterLabel: 'THIS COLUMN LABEL',
      },
    },
    ...
  ];
  return (
    <CDSTable
      {...} // YOUR TABLE CONFIGURATION
      enableColumnsDisplaySettings={true}
    />
  );
};

```

### With Expandable Rows

```tsx
export const Component = () => {
  return (
    <CDSTable
      // YOUR TABLE CONFIGURATION
      enableExpanding={true}
      rowExpansionConfig={{
        expandedRowRender: (row: Row<Type>) => {
          return <div>YOUR CUSTOM EXPANDED ROW RENDER</div>;
        },
        getRowCanExpand: (row: Row<Type>) => {
          return YOUR_CUSTOM_CONDITION;
        },
      }}
    />
  );
};
```

### ColumnSizing

Column sizing is defined in the column definition. There are 3 accepted props related to column sizing:

- `size`: attempts to satisfy the width but will resize if necessary to prevent horizontal scroll
- `minSize`: sets a hard minimum width for the column
- `maxSize`: sets a hard maximum width for the column

### With Row Drag and Drop

```tsx
export const Component = () => {
  const [data, setData] = useState<YourDataType[]>([]);

  const onReorderRow = useCallback(
    ({
      draggedRowIndex,
      targetRowIndex,
      updatedData,
    }: CDSTableOnReorderRowEvent<YourDataType[]>) => {
      // YOUR LOGIC FOR HANDLING THE UPDATED DATA
      setData(updatedData);
    },
    [setData]
  );

  return (
    <CDSContainer>
      <CDSTable data={data} enableReorderRows={true} onReorderRow={onReorderRow} />
    </CDSContainer>
  );
};
```

## Props

### CDSTable

| Name                         | Description                                                                                                                                                                                                                                                                         | Required | Default                                                                     |
| ---------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | --------------------------------------------------------------------------- |
| columns                      | The columns of the table. For API information see: [TanStack Table ColumnDef](https://tanstack.com/table/v8/docs/guide/column-defs). For details on the `meta` expanded attributes see [CDSTable ColumnDef Meta Extended Attributes](#cdstable-columndef-meta-extended-attributes). | yes      | -                                                                           |
| data                         | JSON data of the information to show in the table. If length equals 0, it will show the table in its empty state.                                                                                                                                                                   | yes      | -                                                                           |
| size                         | Spacing around the table cells. Values: `"compact"` \| `"comfy"` \| `"spacious"`                                                                                                                                                                                                    | no       | `"comfy"`                                                                   |
| sticky                       | Keeps the header of a table in the same place relative to the table while the user scrolls down the page.                                                                                                                                                                           | no       | false                                                                       |
| pagination                   | Allows a user to see the total number of pages and navigate to a specific page                                                                                                                                                                                                      | no       | `false`                                                                     |
| paginationConfig             | Allows for configuring the pagination of the table. [CDSTablePaginationConfig API](#cdstablepaginationconfig-api) page                                                                                                                                                              | no       | `{pageSize: 30, showPageSizeChanger: true, pageSizeOptions: [30, 50, 100]}` |
| paginationClassName          | Classname to append onto the pagination container                                                                                                                                                                                                                                   | no       | `undefined`                                                                 |
| actionBarConfig              | Configuration options for the bulk action bar that appears when items are selected. [CDSTableBulkActionBarConfig API](#cdstablebulkactionbarconfig-api)                                                                                                                             | no       | `undefined`                                                                 |
| rowSelection                 | JSON object of rows selected. The key is the index of `data` that is selected. The value is `true` if the row is checked. Both `rowSelection` and `onRowSelection` must be configured together or not at all.                                                                       | no       | `undefined`                                                                 |
| onRowSelectionChange         | Function to update the state of the `rowSelection`. See [Usage](#usage) for examples. Both `rowSelection` and `onRowSelection` must be configured together or not at all.                                                                                                           | no       | `{}`                                                                        |
| enableColumnsDisplaySettings | Allows configuration of visible columns.                                                                                                                                                                                                                                            | no       | `false`                                                                     |
| displaySettingsColumnDef     | Allows for a custom column configuration for the settings column.                                                                                                                                                                                                                   | no       | `undefined`                                                                 |
| enableSortColumns            | Allows for columns to be sorted by drag and drop interaction.                                                                                                                                                                                                                       | no       | `false`                                                                     |
| enableReorderRows            | Allows for rows to be sorted by drag and drop interaction.                                                                                                                                                                                                                          | no       | `false`                                                                     |
| onReorderRow                 | A customized method for sorting rows.                                                                                                                                                                                                                                               | no       | `undefined`                                                                 |
| manualPagination             | Enables manual control of pagination for lazy loading. For API information see: [TanStack Table Pagination - Manual Pagination](https://tanstack.com/table/v8/docs/api/features/pagination#manualpagination)                                                                        | no       | `false`                                                                     |
| onSortingChange              | A callback to sorting the table when using manualPagination.                                                                                                                                                                                                                        | no       | `undefined`                                                                 |
| loading                      | Shows the loading state for the table                                                                                                                                                                                                                                               | no       | `false`                                                                     |
| emptyStateMessage            | The message to display when the table is in its empty state, it overrides the table's default empty state message.                                                                                                                                                                  | no       | `'No matches found'`                                                        |
| emptyState                   | Optional table Empty State, it overrides the table's default empty state.                                                                                                                                                                                                           | no       | `undefined`                                                                 |
| enablePinning                | Enables column pinning feature for the table.                                                                                                                                                                                                                                       | no       | `false`                                                                     |
| columnPinningState           | The table column state of the pinned columns. For API information see: [TanStack - Column Pinning](https://tanstack.com/table/v8/docs/api/features/column-pinning#state)                                                                                                            | no       | `{ left: [], right: [] }`                                                   |
| enableExpanding              | Enables row expansion for the table.                                                                                                                                                                                                                                                | no       | `false`                                                                     |
| rowExpansionConfig           | The required configuration for the row expansion feature. [CDSTableRowExpansionConfig API](#cdstablerowexpansionconfig-api)                                                                                                                                                         | no       | `undefined`                                                                 |
| onRowClick                   | An onClick handler for the table row. As a guideline, must only be used when no other clickable elements exist in the entire row.                                                                                                                                                   | no       | `undefined`                                                                 |

#### CDSTable ColumnDef Meta Extended Attributes

| Name                        | Description                                                                           | Required | Default |
| --------------------------- | ------------------------------------------------------------------------------------- | -------- | ------- |
| align                       | Allows to set the alignment of the column content. Accepts `left`, `right`, `center`. | no       | `left`  |
| columnVisibilityFilterLabel | Allows to set the label for when using `enableColumnsDisplaySettings`.                | no       | `""`    |

### CDSTableBulkActionBarConfig API

| Name                | Description                                                                                                                                                   | Required | Default          |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | ---------------- |
| cancelSelectionText | ReactNode to display on the cancel selection button                                                                                                           | no       | `Cancel`         |
| children            | ReactNode to display on the right side of the bulk action bar next to the cancel button. Examples include a destructive remove button and a tag dropdown menu | no       | `undefined`      |
| className           | Classname to append onto the bulk action bar container                                                                                                        | no       | `undefined`      |
| itemsSelectedText   | ReactNode to display next to the number of items selected                                                                                                     | no       | `items selected` |
| selectAllText       | ReactNode to display on the select all button                                                                                                                 | no       | `Select all`     |

### CDSTablePaginationConfig API

| Name                | Description                                                                                                                                                                                                | Required | Default     |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | ----------- |
| pageSize            | The current page size.                                                                                                                                                                                     | yes      | -           |
| showPageSizeChanger | Controls when to show the page size changer.                                                                                                                                                               | yes      | -           |
| pageSizeOptions     | The options of page sizes for user to select.                                                                                                                                                              | no       | -           |
| pageIndex           | The current page index, used when `manualPagination` is set to `true`.                                                                                                                                     | no       | `undefined` |
| pageCount           | When `manualPagination` is set to `true`, you must pass page count. For API information see: [Tanstack Table Pagination - pageCount](https://tanstack.com/table/v8/docs/api/features/pagination#pagecount) | no       | `undefined` |
| paginationState     | Controls the table pagination state when `manualPagination` is set to `true`.                                                                                                                              | no       | `undefined` |
| onPaginationChange  | Function to be called when a pagination change has ocurred when `manualPagination` is set to `true`.                                                                                                       | no       | `undefined` |
| getRowId            | Function to uniquely identify a row. This is useful when using selectable rows with manual pagination to ensure items are correctly selected when changing pages.                                          | no       | `undefined` |

### CDSTable.FilterBar

| Name                    | Description                                                                           | Required | Default     |
| ----------------------- | ------------------------------------------------------------------------------------- | -------- | ----------- |
| filterDrawerChildren    | Children to display in the filter drawer                                              | no       | `undefined` |
| filterDrawerToggleText  | ReactNode to display in the button that toggles the filter drawer                     | no       | `'Filters'` |
| showGlobalSearch        | Toggles the global search textbox on the left of the filter bar                       | no       | `true`      |
| onGlobalSearchChange    | A callback to be executed when search changes when using table with manualPagination. | no       | `undefined` |
| globalSearchPlaceholder | Placeholder to show in the global search input                                        | no       | `'Search'`  |
| keyFilterChildren       | ReactNode to display between the global search input and the filter drawer toggle     | no       | `undefined` |
| children                | ReactNode to display optional actions at the end of FilterBar.                        | no       | `undefined` |

### CDSTableRowExpansionConfig API

| Name              | Description                                                 | Required | Default |
| ----------------- | ----------------------------------------------------------- | -------- | ------- |
| expandedRowRender | A customized render method with access to the row object.   | yes      | -       |
| getRowCanExpand   | A customized method for detecting when a row is expandable. | yes      | -       |

## Known Issues

The following are known issues and may affect your use of this component.

- [JEST: SyntaxError: Unexpected token 'export'](https://cisco-sbg.atlassian.net/browse/MAGX-700)
- [JEST: SyntaxError: Unexpected token 'export'](https://cisco-sbg.atlassian.net/browse/MAGX-1005)
